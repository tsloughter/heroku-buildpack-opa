#!/bin/sh

indent() {
  sed -u 's/^/       /'
}

BUILD_DIR=$1

echo "-----> Found a Makefile"

# if hello.txt is empty, abort the build
if [ ! -s $1/Makefile ]; then
  echo "Makefile was empty" | indent
  exit 1
fi

echo "-----> Install Opa"
OPA_BINARY="https://s3.amazonaws.com/heroku-opalang2/opa-1.0.7.x86.tar.gz"
OPA_VENDOR="vendor/opa"

mkdir -p $1/$OPA_VENDOR
curl $OPA_BINARY -o - | tar -xz -C $1/$OPA_VENDOR -f -

PATH=$1/$OPA_VENDOR:$PATH
export PATH

cd $BUILD_DIR

# run make
make